## 概述

本项目旨在模拟一个毫米波MIMO-OFDM算法在**三种不同信道信息假设**下的性能，并进行对比分析。这三种假设代表了从理想到实际的不同通信场景，可以清晰地揭示信道估计和有限反馈对系统性能的影响。

仿真的三种核心假设如下：

1.  **完美CSI (Perfect CSI)**
    * **假设**: 基站（BS）拥有完美、瞬时的信道状态信息。
    * **目的**: 该场景忽略了信道估计和反馈中的所有误差，作为系统性能的理论上限（Upper Bound）。

2.  **估计CSI，理想反馈 (Estimated CSI with Perfect Feedback)**
    * **假设**: 基站通过导频（Pilot）来估计信道，因此会引入估计误差。但估计出的信道信息可以被无损、无延迟地反馈给基站。
    * **目的**: 该场景隔离了信道估计带来的性能损失，作为有限反馈场景的一个更实际的性能参照基准。

3.  **估计CSI，有限反馈 (Estimated CSI with Limited Feedback)**
    * **假设**: 信道被估计后，其关键参数（如路径角度、增益或索引）必须先经过量化（Quantization）压缩到有限的比特数 `B`，然后才能反馈给基站。
    * **目的**: 这是最贴近实际的场景，同时包含了信道估计误差和反馈量化误差。本仿真主要研究在该场景下，反馈比特数 `B` 对系统频谱效率的影响。

## 核心算法介绍

混合预编码的目标是设计一个高维的模拟预编码器 $FRF$ 和一个低维的数字预编码器 $FBB$，使其乘积能够逼近理想的全数字预编码器 $Fopt$。本项目主要涉及和参考了MO-AltMin (Manifold Optimization Alternating Minimization)算法[1]。 该算法将混合预编码设计视为一个矩阵分解问题，并采用交替最小化的思想，迭代地优化 $FRF$ 和 $FBB$ 。其核心创新在于，它将模拟预编码器 $FRF$ 中由移相器带来的单位模约束（unit modulus constraints）问题，巧妙地建模为一个在黎曼流形（Riemannian manifold）上的优化问题，从而可以直接求解，获得接近最优的性能。在本项目中，该算法的思想被用于实现高精度的混合预编码器设计。

另外，OMP 是一种广泛应用于压缩感知和稀疏信号恢复的贪婪算法。在混合波束成形的场景中，OMP被用作一种低复杂度的次优方案。其基本思想是：将理想的全数字预编码器 $Fopt$ 视为目标信号，将包含大量候选波束方向的码本（字典）`At` 视为原子库。OMP算法通过迭代的方式，每一次都从码本中选择一个与当前误差（残差）最匹配的原子（波束方向），并将其加入到已选择的集合中，最终构建出模拟预编码器 $FRF$ 。本项目中的信道估计算法 `estimate_swomp` 就是基于OMP的变种（Simultaneous Weighted Orthogonal Matching Pursuit）来实现的。

## 参数配置说明 (`diffB.py`)

主仿真脚本是 `diffB.py`。您可以通过修改此文件开头的参数区域来配置不同的仿真模式。

> `diffSNR.py` 提供了以SNR为自变量的脚本版本，有需要可以自行探索。

- `Nt`, `K`, `L`, `Nc`, `SNR_DB`: 分别为发射天线数、用户数、信道路径数、子载波数、信噪比。
- 在假设三中，我们需要量化器，这里提供两种不同量化策略：
  - `AGQuantizer`: 量化OMP算法选出的路径在码本中的索引和平均增益。
  - `IdxGainQuantizer`: 量化物理角度（Azimuth/Elevation）和平均增益。
- `B_vals`: 反馈比特数列表，定义了有限反馈性能曲线的X轴，只在假设三中使用。
 
- 信道估计关键参数：以下两个参数相互关联，直接影响信道估计的稳定性和准确性，是进行仿真的关键。
  - `Q` (导频长度 - Pilot Length) 是UE用于估计信道的导频符号数量。它是信道估计的“线索”数量。`Q` 越大，估计越准，但系统开销也越大。 **必须与 `omp_ang_n` 匹配**。如果 `omp_ang_n` 很大，`Q` 也必须足够大才能保证估计稳定。
  - `omp_ang_n` (OMP码本角度采样数) 决定了信道估计算法搜索空间的大小。码本总尺寸为 `omp_ang_n` * `omp_ang_n`。`omp_ang_n` 越小，搜索范围越小，用较小的`Q`也能稳定估计，但会引入“基底失配”误差，限制性能上限。`omp_ang_n = 16` 配合 `Q <= 8` 是一个较稳定的起点。如果您想使用更大的码本如 `omp_ang_n = 32`，则需要将 `Q` 提升至 `16` 或 `32` 才能获得可靠结果。


[1] Alternating Minimization Algorithms for Hybrid Precoding in Millimeter Wave MIMO Systems.